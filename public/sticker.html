<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guide Wires</title>
    <link
        href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp"
        rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="/public/css/billary.css">
    <link rel="stylesheet" href="public/css/print.css">
</head>

<body>
    <header>
        <a href="#">Sticker</a>
        <a href="/public/shooter_sticker.html">Shooter</a>
        <a href="/public/qr.html">Qr</a>
        <a href="/logout" onclick="return confirm('Are you sure to logout ?')">Logout</a>
    </header>
    <div id="parrent">

        <div class="product-name"></div>

        <div class="info-container">
            <div class="info-item">
                <b>Ref. No</b>
                <div class="values">
                    <span id="ref-no-info"></span>
                </div>
            </div>
            <div class="info-item">
                <b>O.D</b>

                <div class="values">
                    <span id="od-info"></span>
                </div>
            </div>

            <div class="info-item">
                <b>Length</b>

                <div class="values">
                    <span><span id="length-info"></span> mm</span>
                </div>
            </div>
        </div>
        <div class="features-container">
            <div class="features-item">
                <div class="date-item">
                    <img src="/public/img/mfg.jpg" alt="" width="30px" height="25px">
                    <span id="mfg-date-info"></span>
                </div>
                <div class="date-item">
                    <img src="/public/img/expires.jpg" alt="" width="30px" height="25px">
                    <span id="exp-date-info"></span>
                </div>
            </div>

        </div>
        <div style="text-align: center;">
            <canvas id="barcode"></canvas>
        </div>

        <div class="about-container">
            <b>Mfg by :-</b>
            <span class="about-item" id="mfg-by-info"></span>
            <p style="margin: 0;" id="description-info"></p>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <form id="info-form">
        <div class="form-group">
            <label for="name">Name:</label>
            <input type="text" id="name">
        </div>
        <div class="form-group">
            <label for="ref-no">Ref. No:</label>
            <input type="text" id="ref-no">
        </div>
        <div class="form-group">
            <label for="od">O.D:</label>
            <input type="text" id="od">
        </div>
        <div class="form-group">
            <label for="length">Length:</label>
            <input type="text" id="length">
        </div>
        <div class="form-group">
            <label for="mfg-date">MFG Date:</label>
            <input type="date" id="mfg-date" name="mfg-date" required>
        </div>

        <div class="form-group">
            <label for="exp-date">EXP Date:</label>
            <input type="date" id="exp-date" name="exp-date" required>
        </div>

        <div class="form-group">
            <label for="bar-code">Bar Code:</label>
            <input type="text" id="bar-code" name="bar-code" required>
        </div>

        <div class="form-group">
            <label for="mfg-by">MFG By:</label>
            <input type="text" id="mfg-by" name="mfg-by" required>
        </div>

        <div class="form-group">
            <label for="description">Description:</label>
            <input type="text" id="description" name="description" required>
        </div>

        <button type="submit">Submit</button>
    </form>
    <script src="/js/CustomBarcode.js"></script>
    <script>
        // Run when page loads
        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById("info-form");

            // Elements to update in UI
            const productName = document.querySelector(".product-name");
            const refNoInfo = document.getElementById("ref-no-info");
            const odInfo = document.getElementById("od-info");
            const lengthInfo = document.getElementById("length-info");
            const mfgDateInfo = document.getElementById("mfg-date-info");
            const expDateInfo = document.getElementById("exp-date-info");
            const mfgByInfo = document.getElementById("mfg-by-info");
            const descriptionInfo = document.getElementById("description-info");
            const canvas = document.getElementById("barcode");

            // Form inputs
            const nameInput = document.getElementById("name");
            const refInput = document.getElementById("ref-no");
            const lengthInput = document.getElementById("length");
            const odInput = document.getElementById("od");
            const mfgInput = document.getElementById("mfg-date");
            const expInput = document.getElementById("exp-date");
            const mfgByInput = document.getElementById("mfg-by");
            const descriptionInput = document.getElementById("description");
            const barCodeInput = document.getElementById("bar-code");

            // Load saved data from localStorage if available
            const savedData = JSON.parse(localStorage.getItem("productData"));
            if (savedData) {
                productName.textContent = savedData.name;
                refNoInfo.textContent = savedData.refNo;
                odInfo.textContent = savedData.od;
                lengthInfo.textContent = savedData.length;
                mfgDateInfo.textContent = savedData.mfgDate;
                expDateInfo.textContent = savedData.expDate;
                mfgByInfo.textContent = savedData.mfgBy || "INCORE MEDICAL";
                descriptionInfo.textContent = savedData.description || "";

                barCodeInput.value = savedData.barCode;

                // Prefill form
                nameInput.value = savedData.name;
                refInput.value = savedData.refNo;
                lengthInput.value = savedData.length;
                mfgInput.value = savedData.mfgDate + "-01"; // add day to fit input type="date"
                expInput.value = savedData.expDate + "-01";
                odInput.value = savedData.od;
                mfgByInput.value = savedData.mfgBy || "INCORE MEDICAL";
                descriptionInput.value = savedData.description || "";
                CustomBarcode.renderToCanvas(canvas, savedData.barCode, {
                    mode: "binary",
                    moduleWidth: 2,
                    height: 80,
                    margin: 12,
                    includeText: true
                });
            }

            // Form submit
            form.addEventListener("submit", (e) => {
                e.preventDefault();
                const mfgFormatted = mfgInput.value ? mfgInput.value.slice(0, 7) : "";
                const expFormatted = expInput.value ? expInput.value.slice(0, 7) : "";
                // Get values from form
                const data = {
                    name: nameInput.value,
                    refNo: refInput.value,
                    length: lengthInput.value,
                    od: odInput.value,
                    mfgDate: mfgFormatted,
                    expDate: expFormatted,
                    mfgBy: mfgByInput.value,
                    description: descriptionInput.value,
                    barCode: barCodeInput.value
                };

                // Update UI
                productName.textContent = data.name;
                refNoInfo.textContent = data.refNo;
                odInfo.textContent = data.od;
                lengthInfo.textContent = data.length;
                mfgDateInfo.textContent = data.mfgDate;
                expDateInfo.textContent = data.expDate;
                mfgByInfo.textContent = data.mfgBy;
                descriptionInfo.textContent = data.description;
                // Generate Barcode
                CustomBarcode.renderToCanvas(canvas, barCodeInput.value, {
                    mode: "binary",
                    moduleWidth: 2,
                    height: 80,
                    margin: 12,
                    includeText: true
                });

                // Save to localStorage
                localStorage.setItem("productData", JSON.stringify(data));

            });
        });
    </script>

</body>

</html>